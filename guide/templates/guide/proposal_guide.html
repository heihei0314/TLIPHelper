{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSRF Token for AJAX security -->
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>Education Innovation Proposal Builder</title>
    <link rel="stylesheet" href="{% static 'guide/css/style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <header>
            <h1>Your Education Innovation Proposal</h1>
            <p>Follow these steps to build a compelling project proposal. Mark each step as complete to track your progress.</p>
            
            <div class="progress-container">
                {% with total_steps=steps|length completed_count=completed_step_ids|length %}
                    {% if total_steps > 0 %}
                        {% widthratio completed_count total_steps 100 as initial_progress %}
                    {% else %}
                        {% '0' as initial_progress %}
                    {% endif %}

                    <div id="progress-bar" style="width: {{ initial_progress }}%;"></div>
                    <span id="progress-text">{{ initial_progress }}% Complete ({{ completed_count }} of {{ total_steps }} steps)</span>
                {% endwith %}
            </div>
        </header>

        <main class="card-grid">
            {% for step in steps %}
            <article class="card {% if step.id in completed_step_ids %}completed{% endif %}" data-step-id="{{ step.id }}">
                <div class="card-header">
                    <h2>{{ step.order }}. {{ step.title }}</h2>
                    <span class="status-icon"></span>
                </div>
                <p>{{ step.description }}</p>
                <ul>
                    <!-- The 'linebreaksbr' filter converts newlines to <br> tags -->
                    {% for point in step.guidance_points|linebreaksbr %}
                        <li>{{ point|safe }}</li>
                    {% endfor %}
                </ul>
                <button class="complete-btn">
                    {% if step.id in completed_step_ids %}
                        Mark as Incomplete
                    {% else %}
                        Mark as Complete
                    {% endif %}
                </button>
            </article>
            {% empty %}
                <p>No proposal steps have been created yet. Please add some in the Django admin.</p>
            {% endfor %}
        </main>
    </div>

    <script src="{% static 'guide/js/script.js' %}"></script>
</body>
</html>